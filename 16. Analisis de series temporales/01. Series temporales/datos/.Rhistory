previous_cancellations+
previous_bookings_not_canceled+
is_repeated_guest+
customer_type+
total_of_special_requests+
booking_changes  +
season +
required_car_parking_spaces)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_3)
mod_3 <- glm(is_canceled ~
season  * (hotel+
lead_time +
adults+
children+
adr+
previous_cancellations+
previous_bookings_not_canceled+
is_repeated_guest+
customer_type+
total_of_special_requests+
booking_changes  +
total_nights   +
required_car_parking_spaces)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_3)
mod_4 <- glm(is_canceled ~ .
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ . - required_car_parking_spaces
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ . - required_car_parking_spaces - season
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ . - required_car_parking_spaces - season - customer_type
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ . - required_car_parking_spaces - season - customer_type
#+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ . - required_car_parking_spaces - season - customer_type -children - adults
#+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ .
#+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_4 <- glm(is_canceled ~ .
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_4)
mod_5 <- glm(is_canceled ~ .- required_car_parking_spaces #- season - customer_type - children - adults
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ .+ required_car_parking_spaces:adults #- season - customer_type - children - adults
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ . - required_car_parking_spaces #- season - customer_type - children - adults
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ #. - required_car_parking_spaces #- season - customer_type - children - adults
+ lead_time:customer_type
+ adr:adults
+ lead_time:total_nights
+ is_repeated_guest:previous_cancellations
+ booking_changes:total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ #. - required_car_parking_spaces #- season - customer_type - children - adults
+ lead_time*customer_type
+ adr*adults
+ lead_time*total_nights
+ is_repeated_guest*previous_cancellations
+ booking_changes*total_of_special_requests
+ season*lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ #. - required_car_parking_spaces #- season - customer_type - children - adults
+ lead_time*customer_type
+ adr*adults
+ lead_time*total_nights
+ is_repeated_guest*previous_cancellations
+ booking_changes*total_of_special_requests
+ season:lead_time
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + season + total_nights)
+ adr*adults
+ is_repeated_guest*previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr*adults
+ is_repeated_guest*previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ log(adr + 1) * adults
+ is_repeated_guest*previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest*previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest + previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest + previous_cancellations
+ booking_changes*total_of_special_requests
# + lead_time*customer_type
# + season:lead_time
# + lead_time*total_nights
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes + total_of_special_requests
family=binomial(link="logit"), data=booking.train)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes + total_of_special_requests
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes * total_of_special_requests
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes + total_of_special_requests
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
+ adults
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * ( total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ .
+ lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ .
+ lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
#+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
+ lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
#+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~
+ lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
+ I(adults + children)
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ . +
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ . +
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
mod_5 <- glm(is_canceled ~ #. +
lead_time * (customer_type + total_nights)
+ lead_time:season
+ adr * adults
+ is_repeated_guest * previous_cancellations
+ booking_changes
+ total_of_special_requests
,
family=binomial(link="logit"), data=booking.train)
summary(mod_5)
#library(MASS)
modforw <- stepAIC(mod_5, trace=FALSE, direction="backward")
modforw$anova
plot(allEffects(mod_5), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
.libPaths()
#############################################
#             SERIES TEMPORALES             #
#############################################
library(ggplot2)
library(plotly)
library(tseries)
library(MASS)
library(forecast)
library(lmtest)
library(caschrono)
.libPaths()
install.packages("~/R/win-library/4.1/caschrono_2.0.tgz", repos = NULL, type = .Platform$pkgType)
install.packages("~/R/win-library/4.1/caschrono_2.0.tgz", repos = NULL, type = .Platform$pkgType)
install.packages("~/R/win-library/4.1/caschrono.zip", repos = NULL, type = "win.binary")
.libPaths()
install.packages("~/R/win-library/4.1/caschrono.zip", repos = NULL, type = "win.binary")
library(caschrono)
install.packages("~/R/win-library/4.1/caschrono.zip", repos = NULL, type = "win.binary")
library(caschrono)
#############################################
#             SERIES TEMPORALES             #
#############################################
# Se limpia el espacio de trabajo:
rm(list = ls())
# Se asigna el directorio donde est?n los datos
setwd("C:/Users/jherraez/Documents/masterAFI/16. Analisis de series temporales/01. Series temporales/datos/")
# Carga de datos
datos <- read.csv("series_matriculaciones_tur_paro.csv")
datos$fecha=as.Date(datos$fecha,format='%m/%d/%Y')
datos.train <- subset(datos, fecha<=as.Date('12/01/2016',format='%m/%d/%Y'))
datos.test <- subset(datos, fecha>as.Date('12/01/2016',format='%m/%d/%Y'))
# [1]. Se convierten los datos en un objeto de tipo time series
#      para poder aplicar sobre ellos las funciones de R
################################################################
datos.train.ts <- as.ts(datos.train$target, frequency = 12)
datos.test.ts <- as.ts(datos.test$target, frequency=12)
# [2]. Se representan gr?ficamente los datos
################################################################
# install.packages("ggplot2")
library(ggplot2)
# install.packages("plotly")
library(plotly)
names(datos.train)
graficoInicial <- ggplot(aes(x= fecha, y = target), data = datos.train) +
geom_line(color = '#d84519',
size = 1) +
xlab('FECHA') + ylab('Matriculaciones')
names(datos.train)
ggplot(aes(x= fecha, y = target), data = datos.train) + geom_line(color = '#d84519') +
xlab('FECHA') + ylab('IPI')
ggplotly(graficoInicial)
# [3]. Se estudia la estacionariedad en media y en varianza
#      de la serie
################################################################
# install.packages("tseries")
library(tseries)
# [3.1] ?Es estacionaria en varianza?
# Se eval?a la necesidad de transformar la serie para hacerla
# estacionaria en varianza
# install.packages("MASS")
library(MASS)
box_cox <- boxcox(target ~ fecha,
data = datos.train,
lambda = c(0, 0.5, 1))
lambda <- box_cox$x[which.max(box_cox$y)]
lambda
# -> Se toma logaritmo # ha tomado logaritmo porque esta cerca de 0
datos.train$log_target=log(datos.train$target)
datos.test$log_target=log(datos.test$target)
datos.train.ts <- as.ts(datos.train$log_target, frequency = 12)
datos.test.ts <- as.ts(datos.test$log_target, frequency=12)
# [3.2] ?Es estacionaria en media? (?Hay que diferenciarla?)
# Test de Dickey-Fuller # NO somos muy amigos de este test porque es poco exigente
adf.test(datos.train.ts)
# p-value = 0.329 -> Podría ser necesaria una diferencia regular, pero nosotros ajustamos directamente sin nada
# [4]. Ajuste de un modelo ARIMA a la serie
# install.packages("forecast")
library(forecast)
graphics.off()
acf(datos.train.ts, lag.max = 48, xlab = "Retardo",
main= "Funci?n de autocorrelaci?n simple")
pacf(datos.train.ts, lag.max = 48, xlab = "Retardo",
main = "Funci?n de autocorrelaci?n parcial")
# Se propone un SARIMA(1,0,0)x(0,0,0)12 + MU
ajuste1 <- Arima(datos.train.ts,
order = c(1,0,0),
seasonal = list(order = c(0,0,0),
period = 12),
method = "ML")
ajuste1
# install.packages("lmtest")
library(lmtest)
coeftest(ajuste1)
# install.packages("caschrono")
library(caschrono)
cor.arma(ajuste1) # debajo de 0.8 todo, no correlaciones
Box.test.2(residuals(ajuste1),
nlag = c(6,12,18,24,30,36,42,48),
type="Ljung-Box")                   # queremos valores >0.05 en todos
graphics.off()
acf(ajuste1$residuals, lag.max = 48, xlab = "Retardo", # aquí vemos que sólo se salen en multiplos de 12 y que hay patrón de simetría
main= "Funci?n de autocorrelaci?n simple")
pacf(ajuste1$residuals, lag.max = 48, xlab = "Retardo",
main = "Funci?n de autocorrelaci?n parcial")
