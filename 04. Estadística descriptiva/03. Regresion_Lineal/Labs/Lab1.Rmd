---
title: "Lab1 - Instrucciones para ajustar modelos lineales R"
author: "J. Ramón Sánchez Leo"
date: "19/12/2021"
output: html_document
---

### **<span style="color:#d84519">Afi Escuela - MDS & MDSF</span>**

La instrucción para ajustar un modelo lineal en R es ``lm``:

``lm(formula, data, subset, weights, ...)``

donde 

- ``formula`` es una descripción simbólica del modelo que se pretende ajustar.
- ``data`` es un <i>data frame</i> que contiene los datos con los que se pretende ajustar el modelo.
- ``subset`` es un vector opcional que especifica el subconjunto de observaciones que se van a usar en el proceso de ajuste.
- ``weights`` es un vector opcional de pesos que se van a usar en el proceso de ajuste del modelo. Por defecto ``weights=NULL``, indicando que el ajuste se realizará por mínimos cuadrados ordinarios, y, en caso contrario, si se pasa un vector $w = (w_1, \dots, w_n)$, la función que se minimiza en el ajuste del modelo es el $MSE$ ponderado por $W$, es decir,
$$
MSE_w = \sum_{i=1}^{n} w_i e_i^2.
$$

# El dataset ``Advertising``

```{r, warning=FALSE, message=FALSE}
library(dplyr)
advertising <- read.csv('advertising.csv', sep = ';', header = T, fileEncoding = 'utf-8')
glimpse(advertising)
```

```{r}
summary(advertising)
```

# Diagramas de dispersión por pares

```{r, fig.align='center'}
pairs(advertising, col = 'red')
```


# **<span style="color:#d84519">Ajuste de un modelo lineal simple</span>**

``Sales`` frente a ``TV``:

```{r}
lm_fit_sales_TV <- lm(Sales ~ TV, data = advertising)

lm_fit_sales_TV
```

El modelo es

$$
Sales = 7.03259 + 0.004754\cdot TV
$$


```{r}
summary(lm_fit_sales_TV)
```

```{r}
names(lm_fit_sales_TV)
```


Se pueden obtener intervalos de confianza para los coeficientes

```{r}
confint(lm_fit_sales_TV, level = 0.95)
```

y se pueden hacer predicciones para datos nuevos

```{r}
new_advertising = data.frame(TV = c(100, 150, 200, 250))
predicted_values <- predict(lm_fit_sales_TV, new_advertising, interval = 'confidence')
new_advertising <- cbind(new_advertising, predicted_values)
new_advertising
```


Podemos representar gráficamente el modelo sobre los datos de entrenamiento:

```{r, fig.align='center'}
plot(advertising$TV, advertising$Sales, type = 'p', col = 'red', xlab = 'TV', ylab = 'Sales')
abline(lm_fit_sales_TV, col = 'blue')
```


Por último, también podemos representar gráficamente los residuos del modelo:

```{r, out.width = 750, out.height = 750, fig.align='center'}
plot(advertising$TV, lm_fit_sales_TV$residuals, type = 'p', col = 'red', xlab = 'TV', ylab = 'Sales')
```
