library(tidyverse)
library(effects)
data(Arrests)
head(Arrests)
table(Arrests$released)
prop.table(table(Arrests$released))
# Categorical vs numerical
Arrests %>%
ggplot(aes(x = released, y = age)) +
geom_boxplot(fill="lightblue") +
labs(title = "Released by age", x = "", y = "", col = "")
# Categorical vs categorical
Arrests %>%
ggplot(aes(x= released, fill = colour)) + geom_bar() +
labs(title = "Released by colour", x = "", y = "", col = "")
# Categorical vs categorical
Arrests %>%
ggplot(aes(x= released, fill = sex)) + geom_bar() +
labs(title = "Released by sex", x = "", y = "", col = "")
# Categorical vs numerical
Arrests %>%
ggplot(aes(x = released, y = checks)) +
geom_boxplot(fill="lightblue") +
labs(title = "Released by previous checks", x = "", y = "", col = "")
arrests.mod <- glm(released ~ colour*age, family=binomial(link="logit"), data=Arrests)
arrests.mod <- glm(released ~ colour*age, family=binomial(link="logit"), data=Arrests)
summary(arrests.mod)
plot(effect("colour", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("age", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("colour:age", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
summary(arrests.mod)
arrests.mod <- glm(released ~ employed + citizen + checks + colour*year + colour*age,
family=binomial, data=Arrests)
summary(arrests.mod)
# delete everything
rm(list=ls())
library(tidyverse)
library(GGally)
library(MASS)
library(effects)
library(pscl)
wine_training <- read.csv("wine-training-data.csv", header = TRUE)
wine_training <- read.csv("wine-training-data.csv", header = TRUE)
wine_testing <- read.csv("wine-testing-data.csv", header = TRUE)
head(wine_training,10)
head(wine_testing,10)
summary(wine_training)
hist(rowMeans(is.na(wine_training)))
rowMeans(is.na(wine_training))
barplot(colMeans(is.na(wine_training)), las=2)
wine_training = wine_training %>%
mutate(STARS = ifelse(is.na(STARS), 1, STARS)) %>%
dplyr::select(-INDEX) %>%
na.omit()
wine_testing = wine_testing %>%
mutate(STARS = ifelse(is.na(STARS), 1, STARS)) %>%
dplyr::select(-IN,-TARGET) %>%
na.omit()
wine_training %>%
ggplot(aes(x = as.factor(STARS), y = TARGET)) +
geom_boxplot(fill="lightblue") +
labs(title = "TARGET by STARS", x = "", y = "", col = "")
dim(wine_training)
dim(wine_testing)
8675+2286
2286/10961
barplot(table(wine_training$TARGET), col="darkblue")
wine_training %>%
ggplot(aes(x = FixedAcidity, y = TARGET)) +
geom_point(fill="lightblue") +
labs(title = "Cases by fixed acidity", x = "", y = "", col = "")
ggcorr(wine_training, label = T)
wine_training$STARS = as.factor(wine_training$STARS)
wine_testing$STARS = as.factor(wine_testing$STARS)
fit.lm <- lm(TARGET ~ ., data=wine_training)
summary(fit.lm)
par(mfrow=c(2,2))
plot(fit.lm)
fit.lm <- lm(log(TARGET) ~ ., data=wine_training)
summary(fit.lm)
fit.lm <- lm(log(TARGET) ~ ., data=wine_training)
summary(fit.lm)
barplot(table(log(wine_training$TARGET+1)), col="darkblue")
par(mfrow=c(1,1))
barplot(table(log(wine_training$TARGET+1)), col="darkblue")
fit.lm <- lm(log(TARGET+1) ~ ., data=wine_training)
summary(fit.lm)
par(mfrow=c(2,2))
plot(fit.lm)
par(mfrow=c(1,1))
fit.poisson <- glm(TARGET ~ ., family = "poisson", data = wine_training)
summary(fit.poisson)
fit.poisson <- glm(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal*STARS, family = "poisson", data = wine_training)
summary(fit.poisson)
plot(effect("STARS", fit.poisson), ci.style="band", rescale.axis=FALSE, multiline=TRUE, xlab="stars", ylab="rate", rug=FALSE, main="")
plot(allEffects(fit.poisson), rescale.axis=FALSE, multiline=TRUE, rug=FALSE, main="")
fit.qpoisson <- glm(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal*STARS, family = "quasipoisson", data = wine_training)
summary(fit.qpoisson)
fit.nb <- glm.nb(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal*STARS, data = wine_training)
summary(fit.nb)
mean(wine_training$TARGET)
var(wine_training$TARGET)
mean(wine_training$TARGET)/var(wine_training$TARGET)
?zeroinfl
expCoef = data.frame(matrix(exp(coef(fit.zip1)),ncol=2))
row.names(expCoef) <- names(fit.zip1$coefficients$zero)
fit.zip1 <- zeroinfl(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal+LabelAppeal:STARS, dist = "poisson", data = wine_training)
summary(fit.zip1)
expCoef = data.frame(matrix(exp(coef(fit.zip1)),ncol=2))
row.names(expCoef) <- names(fit.zip1$coefficients$zero)
colnames(expCoef) <- c("Count_model","Zero_inflation_model")
expCoef
fit.zip3 <- zeroinfl(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
AcidIndex + LabelAppeal*STARS | LabelAppeal+LabelAppeal:STARS, dist = "poisson", data = wine_training)
summary(fit.zip3)
AIC.total = c(AIC(fit.poisson), AIC(fit.qpoisson), AIC(fit.nb), AIC(fit.zip1), AIC(fit.zip2), AIC(fit.zip3))
AIC.total
fit.zip2 <- zeroinfl(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal*STARS | 1, dist = "poisson", data = wine_training)
summary(fit.zip2)
AIC.total = c(AIC(fit.poisson), AIC(fit.qpoisson), AIC(fit.nb), AIC(fit.zip1), AIC(fit.zip2), AIC(fit.zip3))
AIC.total
plot(wine_training$TARGET, exp(predict(fit.lm, type = "response"))-1,
xlab="actual",ylab="predicted")
abline(a=0,b=1);
cor(wine_training$TARGET,predict(fit.lm, type = "response"))^2
predict(fit.zip3, newdata=wine_testing, type = "response")
# we should round the numbers:
predictions = round(predict(fit.zip3, newdata=wine_testing, type = "response"), digits=0)
head(predictions,20)
preds = predict(fit.poisson, newdata=wine_testing, type = "link", se.fit=T)
critval <- 1.96 ## approx 95% CI
upr <- preds$fit + (critval * preds$se.fit)
lwr <- preds$fit - (critval * preds$se.fit)
fit <- preds$fit
fit[1:10] # these predictions are in log-scale
fit2 <- fit.poisson$family$linkinv(fit)
upr2 <- fit.poisson$family$linkinv(upr)
lwr2 <- fit.poisson$family$linkinv(lwr)
fit2[1:10] # now the predictions are in counts (but with decimal points)
data.frame(lower=lwr2, prediction=round(fit2,digits=0), upper=upr2)[1:10,]
fit.poisson <- glm(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal*STARS, family = "poisson", data = wine.train)
pred = predict(fit.poisson, newdata=wine.test, type = "response")
# conditional error:
rmse = sqrt(mean((pred-wine.test$TARGET)^2))
rmse
# unconditional error:
sd(wine.test$TARGET)
# GLM is able to reduce 25% the original noise
# R2 in testing set:
cor(pred,wine.test$TARGET)^2
train <- sample(1:nrow(wine_training), round(nrow(wine_training)*0.80,0))
wine.train <- wine_training[train,]
wine.test <- wine_training[-train,]
fit.poisson <- glm(TARGET ~ VolatileAcidity + Chlorides + TotalSulfurDioxide +
FreeSulfurDioxide + AcidIndex + LabelAppeal*STARS, family = "poisson", data = wine.train)
pred = predict(fit.poisson, newdata=wine.test, type = "response")
# conditional error:
rmse = sqrt(mean((pred-wine.test$TARGET)^2))
rmse
# unconditional error:
sd(wine.test$TARGET)
# GLM is able to reduce 25% the original noise
# R2 in testing set:
cor(pred,wine.test$TARGET)^2
fit.zip <- zeroinfl(TARGET ~ . + LabelAppeal:STARS| . , dist = "poisson", data = wine.train)
pred = predict(fit.zip, newdata=wine.test, type = "response")
# conditional error:
rmse = sqrt(mean((pred-wine.test$TARGET)^2))
rmse
# unconditional error:
sd(wine.test$TARGET)
# R2 in testing set:
cor(pred,wine.test$TARGET)^2
# a bit better
52/190
# conditional error:
rmse = sqrt(mean((pred-wine.test$TARGET)^2))
rmse
# unconditional error:
sd(wine.test$TARGET)
1-1.32/1.9
# delete everything
rm(list=ls())
library(tidyverse)
library(effects)
data(Arrests)
head(Arrests)
summary(Arrests$colour)
1288/(1288+3938)
?Arrests
table(Arrests$released)
prop.table(table(Arrests$released))
table(Arrests$released)
prop.table(table(Arrests$released))
# Categorical vs numerical
Arrests %>%
ggplot(aes(x = released, y = age)) +
geom_boxplot(fill="lightblue") +
labs(title = "Released by age", x = "", y = "", col = "")
# Categorical vs categorical
Arrests %>%
ggplot(aes(x= released, fill = colour)) + geom_bar() +
labs(title = "Released by colour", x = "", y = "", col = "")
# Categorical vs categorical
Arrests %>%
ggplot(aes(x= released, fill = sex)) + geom_bar() +
labs(title = "Released by sex", x = "", y = "", col = "")
# Categorical vs categorical
Arrests %>%
ggplot(aes(x= released, fill = sex)) + geom_bar() +
labs(title = "Released by sex", x = "", y = "", col = "")
?glm
?lm
head(Arrests)
log.glm <- glm(log(age)~year, family=gaussian, data=Arrests)
log.glm
summary(log.glm)
log.normal <- glm(log(age)~year, family=gaussian, data=Arrests)
summary(log.normal)
log.normal <- glm(log(age) ~ year, family=gaussian, data=Arrests)
summary(log.normal)
normal.loglink = glm(age ~ year, family=gaussian(link="log"), data=Arrests)
summary(normal.loglink)
arrests.mod <- glm(released ~ colour*age, family=binomial(link="logit"), data=Arrests)
summary(arrests.mod)
plot(effect("colour", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("age", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("colour:age", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
summary(arrests.mod)
confint(arrests.mod)
exp(confint(arrests.mod))
arrests.mod <- glm(released ~ employed + citizen + checks + colour*year + colour*age, family=binomial, data=Arrests)
summary(arrests.mod)
plot(effect("colour", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("employed", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("citizen", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("checks", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("colour:age", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(effect("colour:year", arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
plot(allEffects(arrests.mod), ci.style="band", rescale.axis=FALSE, multiline=TRUE, ylab="P(released)", rug=FALSE, main="")
new.obs = data.frame(colour="Black", age=40, employed="No", citizen="No", checks=2, year=2002)
predict(arrests.mod, newdata=new.obs, type = "response")
new.obs = data.frame(colour="Black", age=40, employed="No", citizen="No", checks=2, year=2022)
predict(arrests.mod, newdata=new.obs, type = "response")
new.obs = data.frame(colour="Black", age=40, employed="No", citizen="No", checks=2, year=1990)
predict(arrests.mod, newdata=new.obs, type = "response")
preds = predict(arrests.mod, newdata=new.obs, type = "link", se.fit=T)
critval <- 1.96 ## approx 95% CI
upr <- preds$fit + (critval * preds$se.fit)
lwr <- preds$fit - (critval * preds$se.fit)
fit <- preds$fit
fit
fit2 <- arrests.mod$family$linkinv(fit)
upr2 <- arrests.mod$family$linkinv(upr)
lwr2 <- arrests.mod$family$linkinv(lwr)
data.frame(lower=lwr2, prediction=fit2, upper=upr2)
new.obs = data.frame(colour="Black", age=40, employed="No", citizen="No", checks=2, year=2002)
predict(arrests.mod, newdata=new.obs, type = "response")
preds = predict(arrests.mod, newdata=new.obs, type = "link", se.fit=T)
critval <- 1.96 ## approx 95% CI
upr <- preds$fit + (critval * preds$se.fit)
lwr <- preds$fit - (critval * preds$se.fit)
fit <- preds$fit
fit
fit2 <- arrests.mod$family$linkinv(fit)
upr2 <- arrests.mod$family$linkinv(upr)
lwr2 <- arrests.mod$family$linkinv(lwr)
data.frame(lower=lwr2, prediction=fit2, upper=upr2)
