setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
detect_outlier < - function(x) {
# calculate first quantile
Quantile1 < - quantile(x, probs=.25)
# calculate third quantile
Quantile3 < - quantile(x, probs=.75)
# calculate inter quartile range
IQR = Quantile3-Quantile1
# return true or false
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
detect_outlier < - function(x) {
# calculate first quantile
Quantile1 < - quantile(x, probs=.25)
# calculate third quantile
Quantile3 < - quantile(x, probs=.75)
# calculate inter quartile range
IQR = Quantile3-Quantile1
# return true or false
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
detect_outlier < - function(x) {
Quantile1 < - quantile(x, probs=.25)
Quantile3 < - quantile(x, probs=.75)
IQR = Quantile3-Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
detect_outlier <- function(x) {
Quantile1 < - quantile(x, probs=.25)
Quantile3 < - quantile(x, probs=.75)
IQR = Quantile3-Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.25)
Quantile3 <- quantile(x, probs=.75)
IQR = Quantile3-Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
remove_outlier(companies, colnames(companies))
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
remove_outlier(companies, colnames(companies))
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.25, na.rm = T)
Quantile3 <- quantile(x, probs=.75, na.rm = T)
IQR = Quantile3-Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
remove_outlier(companies, colnames(companies))
prueba = remove_outlier(companies, colnames(companies))
View(prueba)
bocplot(companies[1:50])
boxplot(companies[1:50])
boxplot(scale(companies[1:50]))
boxplot(scale(companies[51:200]))
for(i in 1:ncol(companies)){
data[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
companies['closure']
companies['closure',]
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
hist(rowSums(is.na(companies)), las=2, breaks = 20)
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.25, na.rm = T)
Quantile3 <- quantile(x, probs=.75, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
boxplot(scale(companies[1:50]))
boxplot(scale(companies[1:50]), las = 2)
boxplot(scale(companies[1:50]), las = 2)
boxplot(scale(companies[51:100]), las = 2)
boxplot(scale(companies[101:150]), las = 2)
boxplot(scale(companies[151:205]), las = 2)
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.05, na.rm = T)
Quantile3 <- quantile(x, probs=.95, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.01, na.rm = T)
Quantile3 <- quantile(x, probs=.99, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.01, na.rm = T)
Quantile3 <- quantile(x, probs=.99, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.01, na.rm = T)
Quantile3 <- quantile(x, probs=.99, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 | x < Quantile1
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
summary(companies$Revenue)
quantile(companies$Revenue, probs=.01, na.rm = T)
companies$Revenue < 0
companies[(companies$Revenue < 0)]
companies[(companies$Revenue < 0),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.01, na.rm = T)
Quantile3 <- quantile(x, probs=.99, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 | x < Quantile1
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
comapnies2 = companies
companies2 = companies
for(i in 1:ncol(companies)){
companies2[is.na(companies2[,i]), i] <- mean(companies2[,i], na.rm = TRUE)
}
prueba = remove_outlier(companies, colnames(companies))
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.01, na.rm = T)
Quantile3 <- quantile(x, probs=.99, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 | x < Quantile1
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba = remove_outlier(companies, colnames(companies))
prueba2 = remove_outlier(companies2, colnames(companies))
boxplot(scale(companies[1:20]), las = 2)
boxplot(scale(companies[1:20]), las = 2, na.rm = T)
boxplot(scale(companies[1:20]))
detect_outlier <- function(x) {
Quantile1 <- quantile(x, probs=.001, na.rm = T)
Quantile3 <- quantile(x, probs=.999, na.rm = T)
IQR = Quantile3 - Quantile1
x > Quantile3 | x < Quantile1
}
remove_outlier <- function(dataframe, columns=names(dataframe)) {
for (col in columns) {
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
print("Remove outliers")
print(dataframe)
}
prueba2 = remove_outlier(companies2, colnames(companies))
summary(companies$Revenue)
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
View(companies)
library(caret)
findCorrelation(companies)
findCorrelation(companies[1:ncol(companies)-1])
df2 = cor(companies[1:ncol(companies)])
hc = findCorrelation(df2, cutoff=0.3) # putt any value as a "cutoff"
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
df2 = cor(companies[1:ncol(companies)])
companies[1:ncol(companies)]
df2 = cor(companies[1:ncol(companies)-1])
df2 = cor(scale(companies[1:ncol(companies)-1]))
hc = findCorrelation(df2, cutoff=0.3) # putt any value as a "cutoff"
df2
corrplot::corrplot(df2)
df2[,colSums(is.na(df2))==0]
df2 <- df2[,colSums(is.na(df2))==0]
hc = findCorrelation(df2, cutoff=0.3) # putt any value as a "cutoff"
df2 = cor(scale(companies[1:ncol(companies)-1]))
df2 <- df2[,colSums(is.na(df2))==0]
hc = findCorrelation(df2, cutoff=0.3)
ncol(df2)
colSums(is.na(df2))
df2 = cor(scale(companies[1:ncol(companies)-1]))
View(df2)
colSums(is.na(df2))
df2 <- df2[is.na(df2)] <- 0
hc = findCorrelation(df2, cutoff=0.3)
df2 = cor(scale(companies[1:ncol(companies)-1]))
df2 <- df2[is.na(df2)] <- 0
df2 = cor(scale(companies[1:ncol(companies)-1]))
df2[is.na(df2)]
View(df2)
df2[is.na(df2)]
as.data.frame(df2[is.na(df2)])
df2 = cor(scale(companies[1:ncol(companies)-1]))
df2 = cor(scale(companies[1:ncol(companies)-1]))
as.data.frame(df2[is.na(df2)])
df2 = as.data.frame(df2)
df2 <- df2[is.na(df2)] <- 0
df2 = cor(scale(companies[1:ncol(companies)-1]))
df2 = as.data.frame(df2)
View(df2)
df2[is.na(df2)]
df2[is.na(df2),]
df2[is.na(df2)]
m <- matrix(sample(c(NA, 1:10), 100, replace = TRUE), 10)
d <- as.data.frame(m)
d[is.na(d)]
d[is.na(d)] <- 0
d
df2 = cor(scale(companies[1:ncol(companies)-1]))
df2 = as.data.frame(df2)
df2[is.na(df2)] <- 0
hc = findCorrelation(df2, cutoff=0.3)
hc = sort(hc)
hc
reduced_Data = companies[1:ncol(companies)-1][,-c(hc)]
print (reduced_Data)
df2 = cor(scale(companies[1:ncol(companies)-1]))
#df2 = as.data.frame(df2)
df2[is.na(df2)] <- 0
hc = findCorrelation(df2, cutoff=0.3)
hc = sort(hc)
reduced_Data = companies[1:ncol(companies)-1][,-c(hc)]
print (reduced_Data)
cor_matrix = cor(scale(companies[1:ncol(companies)-1]))
cor_matrix[is.na(cor_matrix)] <- 0
hc = findCorrelation(cor_matrix, cutoff=0.9)
hc = sort(hc)
reduced_Data = companies[1:ncol(companies)-1][,-c(hc)]
print (reduced_Data)
View(reduced_Data)
cor_matrix = cor(scale(companies[1:ncol(companies)-1]))
cor_matrix[is.na(cor_matrix)] <- 0
high_corr = findCorrelation(cor_matrix, cutoff=0.9)
high_corr = sort(high_corr)
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
companies = cbind(reduced_Data, ncol(companies))
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
cor_matrix = cor(scale(companies[1:ncol(companies)-1]))
cor_matrix[is.na(cor_matrix)] <- 0
high_corr = findCorrelation(cor_matrix, cutoff=0.9)
high_corr = sort(high_corr)
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
companies = cbind(reduced_Data, ncol(companies))
corrplot(cor_matrix)
corrplot::corrplot(cor_matrix)
?corrplot
high_corr = findCorrelation(cor_matrix, cutoff=0.9, verbose = T)
high_corr = findCorrelation(cor_matrix, cutoff=0.9, names = T)
high_corr
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
high_corr = findCorrelation(cor_matrix, cutoff=0.9)
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
cor_matrix = cor(scale(companies[1:ncol(companies)-1]))
cor_matrix[is.na(cor_matrix)] <- 0
high_corr = findCorrelation(cor_matrix, cutoff=0.9)
high_corr = sort(high_corr)
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
companies = cbind(reduced_Data, ncol(companies))
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
cor_matrix = cor(scale(companies[1:ncol(companies)-1]))
cor_matrix[is.na(cor_matrix)] <- 0
high_corr = findCorrelation(cor_matrix, cutoff=0.95)
high_corr = sort(high_corr)
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
companies = cbind(reduced_Data, ncol(companies))
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
library(VIM)
library(caret)
setwd("C:/Users/jherraez/Documents/masterAFI/10. Regresion Avanzada/javier_herraez_albarran_regresion_avanzada/")
set.seed(1404)
companies <- read.csv("2017_Financial_Data.csv", header = TRUE)
ncol(companies)
nrow(companies)
companies <- companies[-c(1, ncol(companies)-2, ncol(companies)-1)]
hist(colSums(is.na(companies)), las=2, breaks = 20)
ncol
sum(colSums(is.na(companies)) > 2000)
companies <- companies[!(colSums(is.na(companies)) > 2000)]
hist(rowSums(is.na(companies)), las=2, breaks = 20)
sum(rowSums(is.na(companies)) > 100)
companies <- companies[!(rowSums(is.na(companies)) > 100),]
for(i in 1:ncol(companies)){
companies[is.na(companies[,i]), i] <- mean(companies[,i], na.rm = TRUE)
}
cor_matrix = cor(scale(companies[1:ncol(companies)-1]))
cor_matrix[is.na(cor_matrix)] <- 0
high_corr = findCorrelation(cor_matrix, cutoff=0.9)
high_corr = sort(high_corr)
reduced_Data = companies[1:ncol(companies)-1][,-c(high_corr)]
companies = cbind(reduced_Data, ncol(companies))
