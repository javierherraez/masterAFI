---
title: "Ejercicios Clase 1"
author: "Alejandro Llorente"
date: "26/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(data.table)
library(igraph)

dd <- fread("soc-Epinions1.txt")
head(dd)
```

### Convertimos el data frame a objeto grafo (graph.data.frame)
```{r}
gg <- graph.data.frame(dd, directed=TRUE)
summary(gg)
vcount(gg)
ecount(gg)
```

```{r}
is_connected(gg, mode="weak")
```

### Calculamos componentes conexas (clusters) y comprobamos el tamaño de las componentes. Luego nos quedamos con la mayor componente conexa fuerte y construimos un grafo conexo con ella
```{r}
#1. calcular las componentes conexas (fuerte)
ccs<-clusters(gg, mode="strong")
idlcc<-which.max(ccs$csize)

#2. identificamos los nodos en la componente conexa mayor
vids<-which(ccs$membership == idlcc)

#3. generamos un subgrafo solamente con estos nodos (induced_subgraph)
g2<-induced_subgraph(gg, vids)

#4. el grafo resulante i) es conexo y ii) tiene un numero de nodos igual al de la mayor SCC visto antes
summary(g2)
```

### Calculamos los grados de los nodos y pintamos su distribución
```{r}
degs<-degree(g2, mode="all")
plot(density(degs),log="xy",xlim=c(5,600),ylim=c(1e-6,1e-1))
```

### Generamos un grafo aleatorio con los mismos nodos y enlaces (erdos.renyi.game), calculamos su distribucion de grados y comparamos con lo anterior
```{r}
ger<-erdos.renyi.game(vcount(g2),type="gnm",p.or.m = ecount(g2))
degsger<-degree(ger,mode="all")
plot(density(degsger))
```


### Calculamos camino medio y diametro
```{r}
average.path.length(g2)
diameter(g2)
```

### visualizamos el grafo utilizando el algoritmo drl o lgl y guardando en png (no imprimir directamente por pantalla!!!)
```{r}
#ll<-layout_with_lgl(g2,maxiter=30)
png("grafo.png",width=1200, height=1200,res=120)
plot(g2, layout=ll, vertex.label="", edge.arrow.size=0, vertex.size=log(degree(g2)), vertex.color="blue")
dev.off()
```

